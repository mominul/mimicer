{% extends 'base.html' %}
{% load static %}

{% block body %}
<!-- Offer Start -->
<div class="container-fluid my-5 py-5 wow fadeInUp" data-wow-delay="0.1s">
    <div class="container py-5">
        <div class="row justify-content-center">
            <div class="col-lg-7 wow zoomIn" data-wow-delay="0.6s">
                <div class="offer-text text-center rounded p-5">
                    <!-- <h1 class="display-9 text-white">Login</h1> -->
                    <!-- <div class="container mt-5"> -->
                        <h2 class="mb-5">Admission Entry Form</h2>
                        <form method="POST">
                            {% csrf_token %}
                            
                            <div class="row mb-3">
                                <label for="subject_id" class="col-sm-4 col-form-label">Subject ID:</label>
                                <div class="col-sm-8">
                                    <input type="text" class="form-control" id="subject_id" name="subject_id" value="{{ subject_id }}" list="subject_id_list" autocomplete="off" required>
                                    <datalist id="subject_id_list">
                                    </datalist>
                                </div>
                            </div>
                    
                            <div class="row mb-3">
                                <label for="hadm_id" class="col-sm-4 col-form-label">Hospital Admission ID:</label>
                                <div class="col-sm-8">
                                    <input type="number" class="form-control" id="hadm_id" name="hadm_id" required>
                                </div>
                            </div>
                    
                            {% comment %} <div class="row mb-3">
                                <label for="admittime" class="col-sm-4 col-form-label">Admission Time:</label>
                                <div class="col-sm-8">
                                    <input type="datetime-local" class="form-control" id="admittime" name="admittime" required>
                                </div>
                            </div> {% endcomment %}
                    
                            <div class="row mb-3">
                                <label for="dischtime" class="col-sm-4 col-form-label">Discharge Time:</label>
                                <div class="col-sm-8">
                                    <input type="datetime-local" class="form-control" id="dischtime" name="dischtime" required>
                                </div>
                            </div>
                    
                            <div class="row mb-3">
                                <label for="deathtime" class="col-sm-4 col-form-label">Death Time:</label>
                                <div class="col-sm-8">
                                    <input type="datetime-local" class="form-control" id="deathtime" name="deathtime">
                                </div>
                            </div>
                    
                            <div class="row mb-3">
                                <label for="admission_type" class="col-sm-4 col-form-label">Admission Type:</label>
                                <div class="col-sm-8">
                                    <select class="form-control" id="admission_type" name="admission_type">
                                        <option>AMBULATORY OBSERVATION</option>
                                        <option>DIRECT EMER.</option>
                                    </select>
                                </div>
                            </div>
                    
                            <div class="row mb-3">
                                <label for="admit_provider_id" class="col-sm-4 col-form-label">Admit Provider ID:</label>
                                <div class="col-sm-8">
                                    <input type="text" class="form-control" id="admit_provider_id" name="admit_provider_id" required>
                                </div>
                            </div>
                    
                            <div class="row mb-3">
                                <label for="admission_location" class="col-sm-4 col-form-label">Admission Location:</label>
                                <div class="col-sm-8">
                                    <select class="form-control" id="admission_location" name="admission_location">
                                        <option value="PHYSICIAN REFERRAL">Physician Referral</option>
                                        <option value="WALK-IN/SELF REFERRAL">Walk-in/Self Referral</option>
                                        <option value="AMBULATORY SURGERY TRANSFER">Ambulatory Surgery Transfer</option>
                                        <option value="INFORMATION NOT AVAILABLE">Information Not Available</option>
                                    </select>
                                </div>
                            </div>
                    
                            <div class="row mb-3">
                                <label for="discharge_location" class="col-sm-4 col-form-label">Discharge Location:</label>
                                <div class="col-sm-8">
                                    <select class="form-control" id="discharge_location" name="discharge_location">
                                        <option value="HOME">Home</option>
                                        <option value="ACUTE HOSPITAL">Acute Hospital</option>
                                        <option value="SKILLED NURSING FACILITY">Skilled Nursing Facility</option>
                                    </select>
                                </div>
                            </div>
                    
                            <div class="row mb-3">
                                <label for="insurance" class="col-sm-4 col-form-label">Insurance:</label>
                                <div class="col-sm-8">
                                    <input type="text" class="form-control" id="insurance" name="insurance" required>
                                </div>
                            </div>
                    
                            <div class="row mb-3">
                                <label for="language" class="col-sm-4 col-form-label">Language:</label>
                                <div class="col-sm-8">
                                    <input type="text" class="form-control" id="language" name="language">
                                </div>
                            </div>
                    
                            <div class="row mb-3">
                                <label for="marital_status" class="col-sm-4 col-form-label">Marital Status:</label>
                                <div class="col-sm-8">
                                    <input type="text" class="form-control" id="marital_status" name="marital_status">
                                </div>
                            </div>
                    
                            <div class="row mb-3">
                                <label for="ethnicity" class="col-sm-4 col-form-label">Ethnicity:</label>
                                <div class="col-sm-8">
                                    <input type="text" class="form-control" id="ethnicity" name="ethnicity">
                                </div>
                            </div>
                    
                            <div class="row mb-3">
                                <label for="edregtime" class="col-sm-4 col-form-label">Emergency Department Registration Time:</label>
                                <div class="col-sm-8">
                                    <input type="datetime-local" class="form-control" id="edregtime" name="edregtime">
                                </div>
                            </div>
                    
                            <div class="row mb-3">
                                <label for="edouttime" class="col-sm-4 col-form-label">Emergency Department Out Time:</label>
                                <div class="col-sm-8">
                                    <input type="datetime-local" class="form-control" id="edouttime" name="edouttime">
                                </div>
                            </div>
                    
                            <div class="row mb-3">
                                <label for="hospital_expire_flag" class="col-sm-4 col-form-label">Hospital Expire Flag:</label>
                                <div class="col-sm-8">
                                    <select class="form-control" id="hospital_expire_flag" name="hospital_expire_flag">
                                        <option value="0">Survived</option>
                                        <option value="1">Expired</option>
                                    </select>
                                </div>
                            </div>
                    
                            <button type="submit" class="btn btn-primary">Submit</button>
                        </form>
                    <!-- </div> -->
                    
                </div>
            </div>
        </div>
    </div>
</div>
<!-- Offer End -->

<script>
    const inputBox = document.getElementById("subject_id");

    inputBox.addEventListener("input", function() {
        const inputValue = inputBox.value.trim();

        if (inputValue === "") {
            // Clear the datalist when the input is empty
            document.getElementById("subject_id_list").innerHTML = "";
            return;
        }

        const endpoint = `{% url "get_patients" %}?query=${inputValue}`;

        // Send a GET request to the endpoint
        fetch(endpoint)
            .then(response => response.json())
            .then(data => {
                const datalist = document.getElementById("subject_id_list");

                // Clear previous options
                datalist.innerHTML = "";

                // Add new options based on JSON response
                data.forEach(item => {
                    const option = document.createElement("option");
                    option.value = item;
                    datalist.appendChild(option);
                });
            })
            .catch(error => {
                console.error("Error fetching data:", error);
            });
    });
</script>
{% endblock body %}
